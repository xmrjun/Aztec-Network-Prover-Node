# Aztec Prover èŠ‚ç‚¹è¿è¡Œæ•™ç¨‹ - ç®€åŒ–ç‰ˆ

## ğŸš€ å¿«é€Ÿå¼€å§‹

### 1. ç³»ç»Ÿè¦æ±‚
- **CPU**: 64æ ¸å¿ƒ+
- **å†…å­˜**: 256GB+
- **å­˜å‚¨**: 1TB+ SSD
- **ç³»ç»Ÿ**: Ubuntu 20.04+

### 2. å®‰è£…Docker
```bash
# ç§»é™¤æ—§ç‰ˆæœ¬
sudo apt update -y && sudo apt upgrade -y
for pkg in docker.io docker-doc docker-compose podman-docker containerd runc; do 
    sudo apt-get remove $pkg; 
done

# å®‰è£…å®˜æ–¹Docker
curl -fsSL https://get.docker.com -o get-docker.sh
sudo sh get-docker.sh
sudo systemctl enable docker
sudo systemctl start docker

# éªŒè¯å®‰è£…
docker --version
```

### 3. å®‰è£…Aztecå·¥å…·
```bash
# å®‰è£…Aztec CLI
bash -i <(curl -s https://install.aztec.network)

# æ·»åŠ åˆ°PATH
echo 'export PATH="$HOME/.aztec/bin:$PATH"' >> ~/.bashrc
source ~/.bashrc

# éªŒè¯
aztec -V
```

### 4. é…ç½®èŠ‚ç‚¹

#### åˆ›å»ºå·¥ä½œç›®å½•
```bash
mkdir -p ~/prover && cd ~/prover
```

#### é…ç½®ç¯å¢ƒå˜é‡ (.envæ–‡ä»¶)
```bash
cat > .env << 'EOF'
# æ›¿æ¢ä¸ºæ‚¨çš„å®é™…é…ç½®
P2P_IP=YOUR_VPS_IP_ADDRESS
ETHEREUM_HOSTS=https://eth-sepolia.g.alchemy.com/v2/YOUR_API_KEY
L1_CONSENSUS_HOST_URLS=https://beacon-nd-123-456-789.p2pify.com/YOUR_API_KEY
PROVER_PUBLISHER_PRIVATE_KEY=0xYOUR_PRIVATE_KEY
PROVER_ID=0xYOUR_WALLET_ADDRESS
EOF
```

#### Docker Composeé…ç½® (docker-compose.yml)
```bash
cat > docker-compose.yml << 'EOF'
name: aztec-prover
services:
  prover-node:
    image: aztecprotocol/aztec:latest
    environment:
      P2P_ENABLED: "true"
      DATA_DIRECTORY: /data-prover
      P2P_IP: ${P2P_IP}
      DATA_STORE_MAP_SIZE_KB: "134217728"
      ETHEREUM_HOSTS: ${ETHEREUM_HOSTS}
      L1_CONSENSUS_HOST_URLS: ${L1_CONSENSUS_HOST_URLS}
      LOG_LEVEL: info
      PROVER_BROKER_HOST: http://broker:8080
      PROVER_PUBLISHER_PRIVATE_KEY: ${PROVER_PUBLISHER_PRIVATE_KEY}
      NODE_OPTIONS: "--max-old-space-size=102400"
      UV_THREADPOOL_SIZE: "16"
    ports:
      - "8080:8080"
      - "40400:40400"
      - "40400:40400/udp"
    volumes:
      - ./data-prover:/data-prover
    deploy:
      resources:
        limits:
          memory: 120G
          cpus: '32'
    restart: unless-stopped
    depends_on:
      - broker
    entrypoint: >
      sh -c 'node --no-warnings /usr/src/yarn-project/aztec/dest/bin/index.js start --network alpha-testnet --archiver --prover-node'

  agent:
    image: aztecprotocol/aztec:latest
    environment:
      PROVER_AGENT_COUNT: "8"
      PROVER_AGENT_POLL_INTERVAL_MS: "10000"
      PROVER_BROKER_HOST: http://broker:8080
      PROVER_ID: ${PROVER_ID}
      NODE_OPTIONS: "--max-old-space-size=25600"
    deploy:
      resources:
        limits:
          memory: 40G
          cpus: '16'
    restart: unless-stopped
    volumes:
      - ./data-prover:/data-prover
    entrypoint: >
      sh -c 'node --no-warnings /usr/src/yarn-project/aztec/dest/bin/index.js start --network alpha-testnet --prover-agent'

  broker:
    image: aztecprotocol/aztec:latest
    environment:
      DATA_DIRECTORY: /data-broker
      LOG_LEVEL: info
      ETHERNET_HOSTS: ${ETHEREUM_HOSTS}
      P2P_IP: ${P2P_IP}
      NODE_OPTIONS: "--max-old-space-size=15360"
    deploy:
      resources:
        limits:
          memory: 20G
          cpus: '8'
    volumes:
      - ./data-broker:/data-broker
    restart: unless-stopped
    entrypoint: >
      sh -c 'node --no-warnings /usr/src/yarn-project/aztec/dest/bin/index.js start --network alpha-testnet --prover-broker'
EOF
```

### 5. å¯åŠ¨èŠ‚ç‚¹
```bash
# å¯åŠ¨æ‰€æœ‰æœåŠ¡
docker compose up -d

# æ£€æŸ¥çŠ¶æ€
docker ps
```

### 6. ç›‘æ§èŠ‚ç‚¹
```bash
# æŸ¥çœ‹æ—¥å¿—
docker logs -f aztec-prover-prover-node-1

# æ£€æŸ¥èµ„æºä½¿ç”¨
docker stats

# æŸ¥çœ‹è¯æ˜ç”Ÿæˆ
docker logs aztec-prover-prover-node-1 | grep "Generated proof"
```

## ğŸ”§ å¸¸è§é—®é¢˜

### Brokerè¿æ¥å¤±è´¥
```bash
# é‡å¯æœåŠ¡
docker compose restart

# æ£€æŸ¥è¿æ¥
docker exec aztec-prover-prover-node-1 curl -s http://broker:8080/health
```

### å†…å­˜ä¸è¶³
```bash
# å‡å°‘Agentæ•°é‡
sed -i 's/PROVER_AGENT_COUNT: "8"/PROVER_AGENT_COUNT: "4"/g' docker-compose.yml
docker compose restart aztec-prover-agent-1
```

### æŸ¥çœ‹åŒæ­¥çŠ¶æ€
```bash
# æ£€æŸ¥P2Pè¿æ¥
docker logs aztec-prover-prover-node-1 | grep "Connected to.*peers"

# æŸ¥çœ‹åŒºå—åŒæ­¥
docker logs aztec-prover-prover-node-1 | grep "Downloaded L2 block"
```

## ğŸ“Š å¿«é€Ÿç›‘æ§è„šæœ¬
```bash
cat > quick_monitor.sh << 'EOF'
#!/bin/bash
echo "=== Aztec Prover çŠ¶æ€ ==="
echo "å®¹å™¨çŠ¶æ€:"
docker ps --format "table {{.Names}}\t{{.Status}}" | grep aztec-prover

echo -e "\nå†…å­˜ä½¿ç”¨:"
free -h | head -2

echo -e "\næœ€æ–°æ´»åŠ¨:"
docker logs --tail 3 aztec-prover-prover-node-1 | grep -E "Generated proof|Downloaded.*block" || echo "æš‚æ— æ´»åŠ¨"
EOF

chmod +x quick_monitor.sh
./quick_monitor.sh
```

## âš¡ æ€§èƒ½è°ƒä¼˜

### æ ¹æ®ç¡¬ä»¶ä¼˜åŒ–Agentæ•°é‡
```bash
# è·å–CPUæ ¸å¿ƒæ•°å¹¶è®¡ç®—åˆç†çš„Agentæ•°é‡
CPU_CORES=$(nproc)
AGENT_COUNT=$((CPU_CORES / 8))
echo "å»ºè®®Agentæ•°é‡: $AGENT_COUNT"

# åº”ç”¨é…ç½®
sed -i "s/PROVER_AGENT_COUNT: \"[0-9]*\"/PROVER_AGENT_COUNT: \"$AGENT_COUNT\"/g" docker-compose.yml
docker compose restart aztec-prover-agent-1
```

## ğŸ¯ é‡è¦æé†’

1. **é¦–æ¬¡å¯åŠ¨éœ€è¦ç­‰å¾…**: ä¸‹è½½CRSæ–‡ä»¶å’ŒåŒæ­¥å¯èƒ½éœ€è¦1-2å°æ—¶
2. **ç›‘æ§èµ„æºä½¿ç”¨**: é¿å…Agentæ•°é‡è¿‡å¤šå¯¼è‡´ç³»ç»Ÿè¿‡è½½
3. **å®šæœŸæ£€æŸ¥æ—¥å¿—**: ç¡®ä¿èŠ‚ç‚¹æ­£å¸¸ç”Ÿæˆè¯æ˜
4. **å¤‡ä»½é…ç½®**: ä¿å­˜å¥½.envæ–‡ä»¶å’Œç§é’¥

## ğŸ“ éœ€è¦å¸®åŠ©ï¼Ÿ

å¦‚æœé‡åˆ°é—®é¢˜ï¼Œå¯ä»¥ï¼š
- æŸ¥çœ‹å®Œæ•´æ•™ç¨‹: `Aztec_Prover_å®Œæ•´è¿è¡Œæ•™ç¨‹.md`
- ä½¿ç”¨æ•…éšœæ’é™¤æŒ‡å—: `Aztec_Prover_æ•…éšœæ’é™¤æŒ‡å—.md`
- è¿è¡Œç›‘æ§è„šæœ¬: `monitor_prover.sh`

ç¥æ‚¨è¿è¡ŒæˆåŠŸï¼ğŸš€