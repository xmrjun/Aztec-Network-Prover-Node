# Aztec Prover ä¼˜åŒ–é…ç½® - 128æ ¸å¿ƒ/377GBä¸“ç”¨

## ğŸš€ æ‚¨çš„ç¡¬ä»¶é…ç½®
- **CPU**: 128æ ¸å¿ƒ â­â­â­
- **å†…å­˜**: 377GB â­â­â­
- **å­˜å‚¨**: 1.8TB NVMe SSD â­â­â­
- **ç³»ç»Ÿ**: Linuxä¸“ç”¨æœåŠ¡å™¨

**è¯„ä¼°**: é¡¶çº§é…ç½®ï¼Œå¯ä»¥è¿è¡Œé«˜æ€§èƒ½ProverèŠ‚ç‚¹ï¼

## ğŸ¯ ä¼˜åŒ–å»ºè®®

åŸºäºæ‚¨çš„128æ ¸å¿ƒé…ç½®ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨æ›´æ¿€è¿›çš„Agenté…ç½®ï¼š

### æ–¹æ¡ˆä¸€ï¼šä¿å®ˆé…ç½®ï¼ˆæ¨èå¼€å§‹ï¼‰
- **Agentæ•°é‡**: 16ä¸ª
- **æ€»å†…å­˜ä½¿ç”¨**: ~250GB
- **CPUä½¿ç”¨**: ~80æ ¸å¿ƒ

### æ–¹æ¡ˆäºŒï¼šé«˜æ€§èƒ½é…ç½®
- **Agentæ•°é‡**: 32ä¸ª  
- **æ€»å†…å­˜ä½¿ç”¨**: ~320GB
- **CPUä½¿ç”¨**: ~120æ ¸å¿ƒ

### æ–¹æ¡ˆä¸‰ï¼šæé™é…ç½®ï¼ˆå®éªŒæ€§ï¼‰
- **Agentæ•°é‡**: 64ä¸ª
- **æ€»å†…å­˜ä½¿ç”¨**: ~360GB
- **CPUä½¿ç”¨**: å…¨éƒ¨128æ ¸å¿ƒ

## ğŸ“‹ ä¼˜åŒ–é…ç½®æ–‡ä»¶

### ä¿å®ˆé…ç½® Docker Compose (æ¨è)
```bash
mkdir -p ~/prover && cd ~/prover

# åˆ›å»ºç¯å¢ƒå˜é‡æ–‡ä»¶
cat > .env << 'EOF'
# æ›¿æ¢ä¸ºæ‚¨çš„å®é™…é…ç½®
P2P_IP=YOUR_VPS_IP_ADDRESS
ETHEREUM_HOSTS=https://eth-sepolia.g.alchemy.com/v2/YOUR_API_KEY
L1_CONSENSUS_HOST_URLS=https://beacon-nd-123-456-789.p2pify.com/YOUR_API_KEY
PROVER_PUBLISHER_PRIVATE_KEY=0xYOUR_PRIVATE_KEY
PROVER_ID=0xYOUR_WALLET_ADDRESS
EOF

# åˆ›å»ºDocker Composeé…ç½®
cat > docker-compose.yml << 'EOF'
name: aztec-prover
services:
  prover-node:
    image: aztecprotocol/aztec:latest
    environment:
      P2P_ENABLED: "true"
      DATA_DIRECTORY: /data-prover
      P2P_IP: ${P2P_IP}
      DATA_STORE_MAP_SIZE_KB: "134217728"
      ETHEREUM_HOSTS: ${ETHEREUM_HOSTS}
      L1_CONSENSUS_HOST_URLS: ${L1_CONSENSUS_HOST_URLS}
      LOG_LEVEL: info
      PROVER_BROKER_HOST: http://broker:8080
      PROVER_PUBLISHER_PRIVATE_KEY: ${PROVER_PUBLISHER_PRIVATE_KEY}
      NODE_OPTIONS: "--max-old-space-size=153600"  # 150GB
      UV_THREADPOOL_SIZE: "32"
    ports:
      - "8080:8080"
      - "40400:40400"
      - "40400:40400/udp"
    volumes:
      - ./data-prover:/data-prover
    deploy:
      resources:
        limits:
          memory: 180G
          cpus: '64'
        reservations:
          memory: 120G
          cpus: '32'
    restart: unless-stopped
    depends_on:
      - broker
    entrypoint: >
      sh -c 'node --no-warnings /usr/src/yarn-project/aztec/dest/bin/index.js start --network alpha-testnet --archiver --prover-node'

  agent:
    image: aztecprotocol/aztec:latest
    environment:
      PROVER_AGENT_COUNT: "16"  # 16ä¸ªAgent
      PROVER_AGENT_POLL_INTERVAL_MS: "5000"  # æ›´é¢‘ç¹è½®è¯¢
      PROVER_BROKER_HOST: http://broker:8080
      PROVER_ID: ${PROVER_ID}
      NODE_OPTIONS: "--max-old-space-size=51200"  # 50GB
    deploy:
      resources:
        limits:
          memory: 80G
          cpus: '48'
        reservations:
          memory: 40G
          cpus: '24'
    restart: unless-stopped
    volumes:
      - ./data-prover:/data-prover
    entrypoint: >
      sh -c 'node --no-warnings /usr/src/yarn-project/aztec/dest/bin/index.js start --network alpha-testnet --prover-agent'

  broker:
    image: aztecprotocol/aztec:latest
    environment:
      DATA_DIRECTORY: /data-broker
      LOG_LEVEL: info
      ETHEREUM_HOSTS: ${ETHEREUM_HOSTS}
      P2P_IP: ${P2P_IP}
      NODE_OPTIONS: "--max-old-space-size=25600"  # 25GB
    deploy:
      resources:
        limits:
          memory: 40G
          cpus: '16'
        reservations:
          memory: 20G
          cpus: '8'
    volumes:
      - ./data-broker:/data-broker
    restart: unless-stopped
    entrypoint: >
      sh -c 'node --no-warnings /usr/src/yarn-project/aztec/dest/bin/index.js start --network alpha-testnet --prover-broker'
EOF
```

### é«˜æ€§èƒ½é…ç½® (32 Agents)
```bash
# å¦‚æœä¿å®ˆé…ç½®è¿è¡Œç¨³å®šï¼Œå¯ä»¥å°è¯•è¿™ä¸ªé…ç½®
cat > docker-compose-high-performance.yml << 'EOF'
name: aztec-prover
services:
  prover-node:
    image: aztecprotocol/aztec:latest
    environment:
      P2P_ENABLED: "true"
      DATA_DIRECTORY: /data-prover
      P2P_IP: ${P2P_IP}
      DATA_STORE_MAP_SIZE_KB: "134217728"
      ETHEREUM_HOSTS: ${ETHEREUM_HOSTS}
      L1_CONSENSUS_HOST_URLS: ${L1_CONSENSUS_HOST_URLS}
      LOG_LEVEL: info
      PROVER_BROKER_HOST: http://broker:8080
      PROVER_PUBLISHER_PRIVATE_KEY: ${PROVER_PUBLISHER_PRIVATE_KEY}
      NODE_OPTIONS: "--max-old-space-size=204800"  # 200GB
      UV_THREADPOOL_SIZE: "64"
    ports:
      - "8080:8080"
      - "40400:40400"
      - "40400:40400/udp"
    volumes:
      - ./data-prover:/data-prover
    deploy:
      resources:
        limits:
          memory: 240G
          cpus: '80'
        reservations:
          memory: 180G
          cpus: '40'
    restart: unless-stopped
    depends_on:
      - broker
    entrypoint: >
      sh -c 'node --no-warnings /usr/src/yarn-project/aztec/dest/bin/index.js start --network alpha-testnet --archiver --prover-node'

  agent:
    image: aztecprotocol/aztec:latest
    environment:
      PROVER_AGENT_COUNT: "32"  # 32ä¸ªAgent
      PROVER_AGENT_POLL_INTERVAL_MS: "3000"
      PROVER_BROKER_HOST: http://broker:8080
      PROVER_ID: ${PROVER_ID}
      NODE_OPTIONS: "--max-old-space-size=76800"  # 75GB
    deploy:
      resources:
        limits:
          memory: 120G
          cpus: '64'
        reservations:
          memory: 60G
          cpus: '32'
    restart: unless-stopped
    volumes:
      - ./data-prover:/data-prover
    entrypoint: >
      sh -c 'node --no-warnings /usr/src/yarn-project/aztec/dest/bin/index.js start --network alpha-testnet --prover-agent'

  broker:
    image: aztecprotocol/aztec:latest
    environment:
      DATA_DIRECTORY: /data-broker
      LOG_LEVEL: info
      ETHEREUM_HOSTS: ${ETHEREUM_HOSTS}
      P2P_IP: ${P2P_IP}
      NODE_OPTIONS: "--max-old-space-size=32768"  # 32GB
    deploy:
      resources:
        limits:
          memory: 50G
          cpus: '16'
        reservations:
          memory: 25G
          cpus: '8'
    volumes:
      - ./data-broker:/data-broker
    restart: unless-stopped
    entrypoint: >
      sh -c 'node --no-warnings /usr/src/yarn-project/aztec/dest/bin/index.js start --network alpha-testnet --prover-broker'
EOF
```

## ğŸš€ å¿«é€Ÿéƒ¨ç½²è„šæœ¬

```bash
# åˆ›å»ºä¸€é”®éƒ¨ç½²è„šæœ¬
cat > deploy_aztec_128core.sh << 'EOF'
#!/bin/bash
set -e

echo "ğŸš€ éƒ¨ç½²Aztec Prover - 128æ ¸å¿ƒä¼˜åŒ–ç‰ˆ"
echo "=================================="

# æ£€æŸ¥ç³»ç»Ÿèµ„æº
echo "ğŸ“Š ç³»ç»Ÿèµ„æºæ£€æŸ¥:"
echo "CPUæ ¸å¿ƒ: $(nproc)"
echo "æ€»å†…å­˜: $(free -h | awk 'NR==2{print $2}')"
echo "å¯ç”¨å­˜å‚¨: $(df -h / | awk 'NR==2{print $4}')"
echo ""

# åˆ›å»ºå·¥ä½œç›®å½•
mkdir -p ~/prover
cd ~/prover

# è®¾ç½®ç³»ç»Ÿä¼˜åŒ–å‚æ•°
echo "âš™ï¸ ä¼˜åŒ–ç³»ç»Ÿå‚æ•°..."
sudo sysctl -w vm.max_map_count=262144
sudo sysctl -w fs.file-max=1000000
sudo sysctl -w net.core.rmem_max=134217728
sudo sysctl -w net.core.wmem_max=134217728

# æ£€æŸ¥Docker
if ! command -v docker &> /dev/null; then
    echo "âŒ Dockeræœªå®‰è£…ï¼Œè¯·å…ˆå®‰è£…Docker"
    exit 1
fi

echo "âœ… Dockerå·²å®‰è£…: $(docker --version)"

# æç¤ºç”¨æˆ·é…ç½®ç¯å¢ƒå˜é‡
if [ ! -f .env ]; then
    echo "âš ï¸ è¯·å…ˆåˆ›å»º.envæ–‡ä»¶å¹¶é…ç½®ä»¥ä¸‹å˜é‡:"
    echo "P2P_IP=YOUR_VPS_IP_ADDRESS"
    echo "ETHEREUM_HOSTS=https://eth-sepolia.g.alchemy.com/v2/YOUR_API_KEY"
    echo "L1_CONSENSUS_HOST_URLS=https://beacon-nd-123-456-789.p2pify.com/YOUR_API_KEY"
    echo "PROVER_PUBLISHER_PRIVATE_KEY=0xYOUR_PRIVATE_KEY"
    echo "PROVER_ID=0xYOUR_WALLET_ADDRESS"
    echo ""
    echo "åˆ›å»ºåå†æ¬¡è¿è¡Œæ­¤è„šæœ¬"
    exit 1
fi

# å¯åŠ¨æœåŠ¡
echo "ğŸš€ å¯åŠ¨Aztec ProveræœåŠ¡..."
docker compose up -d

echo "â³ ç­‰å¾…30ç§’æœåŠ¡å¯åŠ¨..."
sleep 30

# æ£€æŸ¥çŠ¶æ€
echo "ğŸ“‹ å®¹å™¨çŠ¶æ€:"
docker ps --format "table {{.Names}}\t{{.Status}}\t{{.Ports}}" | grep aztec-prover

echo ""
echo "ğŸ‰ éƒ¨ç½²å®Œæˆï¼"
echo ""
echo "ğŸ“Š ç›‘æ§å‘½ä»¤:"
echo "docker logs -f aztec-prover-prover-node-1     # æŸ¥çœ‹ä¸»èŠ‚ç‚¹æ—¥å¿—"
echo "docker stats                                   # æŸ¥çœ‹èµ„æºä½¿ç”¨"
echo "./monitor_128core.sh                          # è¿è¡Œç›‘æ§è„šæœ¬"

EOF

chmod +x deploy_aztec_128core.sh
```

## ğŸ“Š ä¸“ç”¨ç›‘æ§è„šæœ¬

```bash
# åˆ›å»º128æ ¸å¿ƒä¸“ç”¨ç›‘æ§è„šæœ¬
cat > monitor_128core.sh << 'EOF'
#!/bin/bash

echo "ğŸ” Aztec Prover 128æ ¸å¿ƒç›‘æ§ - $(date)"
echo "================================================"

# å®¹å™¨çŠ¶æ€
echo "ğŸ“¦ å®¹å™¨çŠ¶æ€:"
docker ps --format "table {{.Names}}\t{{.Status}}\t{{.Image}}" | grep aztec-prover || echo "âŒ å®¹å™¨æœªè¿è¡Œ"

echo ""

# èµ„æºä½¿ç”¨è¯¦æƒ…
echo "ğŸ’¾ è¯¦ç»†èµ„æºä½¿ç”¨:"
docker stats --no-stream --format "table {{.Container}}\t{{.CPUPerc}}\t{{.MemUsage}}\t{{.MemPerc}}" | grep aztec-prover || echo "âŒ æ— æ³•è·å–èµ„æºä¿¡æ¯"

echo ""

# ç³»ç»Ÿèµ„æº
echo "ğŸ–¥ï¸ ç³»ç»Ÿèµ„æº:"
echo "CPU: $(nproc)æ ¸å¿ƒ"
echo "å†…å­˜: $(free -h | awk 'NR==2{printf "å·²ç”¨ %s / æ€»è®¡ %s (%.1f%%)", $3, $2, ($3/$2)*100}')"
echo "ç£ç›˜: $(df -h / | awk 'NR==2{printf "å·²ç”¨ %s / æ€»è®¡ %s (%s)", $3, $2, $5}')"

echo ""

# Brokerè¿æ¥æ£€æŸ¥
echo "ğŸ”— æœåŠ¡è¿æ¥:"
if docker exec aztec-prover-prover-node-1 curl -s http://broker:8080/health >/dev/null 2>&1; then
    echo "âœ… Brokerè¿æ¥æ­£å¸¸"
else
    echo "âŒ Brokerè¿æ¥å¤±è´¥"
fi

echo ""

# æœ€æ–°æ´»åŠ¨
echo "ğŸ“‹ æœ€æ–°æ´»åŠ¨ (æœ€è¿‘10æ¡):"
docker logs --tail 10 aztec-prover-prover-node-1 2>&1 | grep -E "Generated proof|Downloaded.*block|Connected.*peers|TUBE_PROOF.*completed" | tail -5 || echo "æš‚æ— ç›¸å…³æ´»åŠ¨"

echo ""

# Agentå·¥ä½œçŠ¶æ€
echo "âš¡ Agentå·¥ä½œçŠ¶æ€:"
agent_logs=$(docker logs --tail 50 aztec-prover-agent-1 2>&1)
if echo "$agent_logs" | grep -q "started"; then
    agent_count=$(echo "$agent_logs" | grep -o "PROVER_AGENT_COUNT.*" | tail -1 || echo "æœªçŸ¥")
    echo "âœ… Agentæ­£åœ¨è¿è¡Œ ($agent_count)"
else
    echo "âŒ AgentçŠ¶æ€å¼‚å¸¸"
fi

echo ""

# P2Pç½‘ç»œçŠ¶æ€
echo "ğŸŒ P2Pç½‘ç»œ:"
p2p_info=$(docker logs --tail 20 aztec-prover-prover-node-1 2>&1 | grep -i "connected.*peers" | tail -1)
if [ -n "$p2p_info" ]; then
    echo "âœ… $p2p_info"
else
    echo "â³ æ­£åœ¨è¿æ¥P2Pç½‘ç»œ..."
fi

echo ""
echo "ğŸ”„ ä½¿ç”¨ 'watch -n 30 ./monitor_128core.sh' è¿›è¡ŒæŒç»­ç›‘æ§"

EOF

chmod +x monitor_128core.sh
```

## âš¡ æ€§èƒ½è°ƒä¼˜å»ºè®®

### 1. æ¸è¿›å¼éƒ¨ç½²ç­–ç•¥
```bash
# ç¬¬ä¸€é˜¶æ®µï¼šä»16ä¸ªAgentå¼€å§‹
echo "PROVER_AGENT_COUNT=16" >> .env

# ç›‘æ§1å°æ—¶ï¼Œå¦‚æœç¨³å®šåˆ™å‡çº§åˆ°32ä¸ª
# sed -i 's/PROVER_AGENT_COUNT=16/PROVER_AGENT_COUNT=32/' .env
# docker compose restart aztec-prover-agent-1
```

### 2. ç³»ç»Ÿä¼˜åŒ–å‘½ä»¤
```bash
# ä¼˜åŒ–å†…æ ¸å‚æ•°
sudo tee -a /etc/sysctl.conf << EOF
vm.max_map_count=262144
fs.file-max=1000000
net.core.rmem_max=134217728
net.core.wmem_max=134217728
net.ipv4.tcp_rmem=4096 87380 134217728
net.ipv4.tcp_wmem=4096 65536 134217728
EOF

sudo sysctl -p
```

### 3. Dockerä¼˜åŒ–
```bash
# åˆ›å»ºDockerå®ˆæŠ¤è¿›ç¨‹é…ç½®
sudo tee /etc/docker/daemon.json << EOF
{
  "default-ulimits": {
    "nofile": {
      "Name": "nofile",
      "Hard": 1000000,
      "Soft": 1000000
    }
  },
  "max-concurrent-downloads": 10,
  "max-concurrent-uploads": 10
}
EOF

sudo systemctl restart docker
```

## ğŸ¯ é¢„æœŸæ€§èƒ½

åŸºäºæ‚¨çš„128æ ¸å¿ƒ/377GBé…ç½®ï¼š

- **16 Agents**: é¢„æœŸè¯æ˜ç”Ÿæˆé€Ÿåº¦æå‡4-6å€
- **32 Agents**: é¢„æœŸè¯æ˜ç”Ÿæˆé€Ÿåº¦æå‡8-12å€
- **å†…å­˜ä½¿ç”¨**: é¢„è®¡250-320GB
- **CPUä½¿ç”¨**: é¢„è®¡80-120æ ¸å¿ƒ

## ğŸš¨ é‡è¦æé†’

1. **ä»ä¿å®ˆé…ç½®å¼€å§‹**: å…ˆè¿è¡Œ16 Agenté…ç½®
2. **ç›‘æ§èµ„æºä½¿ç”¨**: å¯†åˆ‡å…³æ³¨å†…å­˜å’ŒCPUä½¿ç”¨
3. **é€æ­¥å‡çº§**: ç¨³å®šåå†è€ƒè™‘32 Agenté…ç½®
4. **å¤‡ä»½é…ç½®**: ä¿å­˜å¥½æ‰€æœ‰é…ç½®æ–‡ä»¶

æ‚¨çš„ç¡¬ä»¶é…ç½®å¯ä»¥è¿è¡Œéå¸¸é«˜æ€§èƒ½çš„ProverèŠ‚ç‚¹ï¼å»ºè®®å…ˆä»16 Agentçš„ä¿å®ˆé…ç½®å¼€å§‹æµ‹è¯•ã€‚